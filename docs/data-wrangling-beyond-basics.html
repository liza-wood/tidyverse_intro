<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4 Data wrangling: beyond basics | Tidyverse: Data wrangling &amp; visualization</title>
  <meta name="description" content="4 Data wrangling: beyond basics | Tidyverse: Data wrangling &amp; visualization" />
  <meta name="generator" content="bookdown 0.33 and GitBook 2.6.7" />

  <meta property="og:title" content="4 Data wrangling: beyond basics | Tidyverse: Data wrangling &amp; visualization" />
  <meta property="og:type" content="book" />
  
  
  <meta name="github-repo" content="liza-wood/tidyverse_intro" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4 Data wrangling: beyond basics | Tidyverse: Data wrangling &amp; visualization" />
  
  
  

<meta name="author" content="Liza Wood" />


<meta name="date" content="2023-04-27" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="data-wrangling-basics.html"/>
<link rel="next" href="visualization.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="styling.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="https://allisonhorst.github.io/palmerpenguins/">
  <img src="img/lter_penguins.png" style="height: 100%; width: 100%; object-fit: contain" />
  <figcaption style="font-size: 8px">Artwork by @allison_horst</figcaption>
</a></li>
<li><a href="./" style="font-size: 15px">Tidyverse: Data wrangling & visualization</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Overview</a>
<ul>
<li class="chapter" data-level="0.1" data-path="index.html"><a href="index.html#introduction"><i class="fa fa-check"></i><b>0.1</b> Introduction</a></li>
<li class="chapter" data-level="0.2" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i><b>0.2</b> Acknowledgements</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="introduction-to-the-tidyverse.html"><a href="introduction-to-the-tidyverse.html"><i class="fa fa-check"></i><b>1</b> Introduction to the Tidyverse</a>
<ul>
<li class="chapter" data-level="1.1" data-path="introduction-to-the-tidyverse.html"><a href="introduction-to-the-tidyverse.html#what-is-the-tidyverse"><i class="fa fa-check"></i><b>1.1</b> What is the tidyverse?</a></li>
<li class="chapter" data-level="1.2" data-path="introduction-to-the-tidyverse.html"><a href="introduction-to-the-tidyverse.html#installing-and-loading-in"><i class="fa fa-check"></i><b>1.2</b> Installing and loading in</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="data.html"><a href="data.html"><i class="fa fa-check"></i><b>2</b> Data</a>
<ul>
<li class="chapter" data-level="2.1" data-path="data.html"><a href="data.html#palmer-station-penguins"><i class="fa fa-check"></i><b>2.1</b> Palmer Station penguins</a></li>
<li class="chapter" data-level="2.2" data-path="data.html"><a href="data.html#palmer-station-weather"><i class="fa fa-check"></i><b>2.2</b> Palmer Station weather</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="data-wrangling-basics.html"><a href="data-wrangling-basics.html"><i class="fa fa-check"></i><b>3</b> Data wrangling basics</a>
<ul>
<li class="chapter" data-level="3.1" data-path="data-wrangling-basics.html"><a href="data-wrangling-basics.html#outline"><i class="fa fa-check"></i><b>3.1</b> Outline</a></li>
<li class="chapter" data-level="3.2" data-path="data-wrangling-basics.html"><a href="data-wrangling-basics.html#reducing-data-dimensionality"><i class="fa fa-check"></i><b>3.2</b> Reducing data dimensionality</a></li>
<li class="chapter" data-level="3.3" data-path="data-wrangling-basics.html"><a href="data-wrangling-basics.html#combining-multiple-steps"><i class="fa fa-check"></i><b>3.3</b> Combining multiple steps</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="data-wrangling-basics.html"><a href="data-wrangling-basics.html#check-in-challenge"><i class="fa fa-check"></i><b>3.3.1</b> Check in challenge</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="data-wrangling-basics.html"><a href="data-wrangling-basics.html#creating-new-variables"><i class="fa fa-check"></i><b>3.4</b> Creating new variables</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="data-wrangling-basics.html"><a href="data-wrangling-basics.html#new-columns"><i class="fa fa-check"></i><b>3.4.1</b> New columns</a></li>
<li class="chapter" data-level="3.4.2" data-path="data-wrangling-basics.html"><a href="data-wrangling-basics.html#summary-tables"><i class="fa fa-check"></i><b>3.4.2</b> Summary tables</a></li>
<li class="chapter" data-level="3.4.3" data-path="data-wrangling-basics.html"><a href="data-wrangling-basics.html#check-in-challenge-1"><i class="fa fa-check"></i><b>3.4.3</b> Check in challenge</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="data-wrangling-beyond-basics.html"><a href="data-wrangling-beyond-basics.html"><i class="fa fa-check"></i><b>4</b> Data wrangling: beyond basics</a>
<ul>
<li class="chapter" data-level="4.1" data-path="data-wrangling-beyond-basics.html"><a href="data-wrangling-beyond-basics.html#outline-1"><i class="fa fa-check"></i><b>4.1</b> Outline</a></li>
<li class="chapter" data-level="4.2" data-path="data-wrangling-beyond-basics.html"><a href="data-wrangling-beyond-basics.html#manipulating-date-variables"><i class="fa fa-check"></i><b>4.2</b> Manipulating date variables</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="data-wrangling-beyond-basics.html"><a href="data-wrangling-beyond-basics.html#check-in-challenge-2"><i class="fa fa-check"></i><b>4.2.1</b> Check in challenge</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="data-wrangling-beyond-basics.html"><a href="data-wrangling-beyond-basics.html#joining-multiple-data-frames"><i class="fa fa-check"></i><b>4.3</b> Joining multiple data frames</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="data-wrangling-beyond-basics.html"><a href="data-wrangling-beyond-basics.html#check-in-challenge-3"><i class="fa fa-check"></i><b>4.3.1</b> Check in challenge</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="data-wrangling-beyond-basics.html"><a href="data-wrangling-beyond-basics.html#reshaping-lengtheningwidening-data"><i class="fa fa-check"></i><b>4.4</b> Reshaping (lengthening/widening) data</a></li>
<li class="chapter" data-level="4.5" data-path="data-wrangling-beyond-basics.html"><a href="data-wrangling-beyond-basics.html#working-with-text"><i class="fa fa-check"></i><b>4.5</b> Working with text</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="data-wrangling-beyond-basics.html"><a href="data-wrangling-beyond-basics.html#check-in-challenge-4"><i class="fa fa-check"></i><b>4.5.1</b> Check in challenge</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="visualization.html"><a href="visualization.html"><i class="fa fa-check"></i><b>5</b> Visualization</a>
<ul>
<li class="chapter" data-level="5.1" data-path="visualization.html"><a href="visualization.html#outline-2"><i class="fa fa-check"></i><b>5.1</b> Outline</a></li>
<li class="chapter" data-level="5.2" data-path="visualization.html"><a href="visualization.html#plot-architecture"><i class="fa fa-check"></i><b>5.2</b> Plot architecture</a></li>
<li class="chapter" data-level="5.3" data-path="visualization.html"><a href="visualization.html#selecting-geometries"><i class="fa fa-check"></i><b>5.3</b> Selecting geometries</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="visualization.html"><a href="visualization.html#combining-wrangling-visualization"><i class="fa fa-check"></i><b>5.3.1</b> Combining wrangling &amp; visualization</a></li>
<li class="chapter" data-level="5.3.2" data-path="visualization.html"><a href="visualization.html#check-in-challenge-5"><i class="fa fa-check"></i><b>5.3.2</b> Check in challenge</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="visualization.html"><a href="visualization.html#styling"><i class="fa fa-check"></i><b>5.4</b> Styling</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Tidyverse: Data wrangling &amp; visualization</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="data-wrangling-beyond-basics" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">4</span> Data wrangling: beyond basics<a href="data-wrangling-beyond-basics.html#data-wrangling-beyond-basics" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="outline-1" class="section level2 hasAnchor" number="4.1">
<h2><span class="header-section-number">4.1</span> Outline<a href="data-wrangling-beyond-basics.html#outline-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>Manipulating date variables:
<ul>
<li><code>lubridate</code> package: Use date format functions (e.g. <code>ymd</code>) to specify date data formats</li>
</ul></li>
<li>Joining multiple data frames:
<ul>
<li><code>_join</code> series: Combine two data frames by one or more shared columns. Specify with kind of join(<code>full_</code>, <code>left_</code>, etc.) to determine which observations are kept/dropped.</li>
</ul></li>
<li>Reshaping (lengthening/widening) data:
<ul>
<li><code>pivot_longer</code>: Take values spread across multiple columns and ‘lengthen’ the data by stacking those columns on top of one another</li>
<li><code>pivot_wider</code>: Take ‘long’ values stacked into one column and ‘widen’ the data by spreading them out</li>
</ul></li>
<li>Working with text:
<ul>
<li><code>separate</code>: divide the contents of one columns into multiple based on particular symbols<br />
</li>
<li><code>paste</code>: combine contents from multiple columns (or external text)</li>
</ul></li>
</ul>
</div>
<div id="manipulating-date-variables" class="section level2 hasAnchor" number="4.2">
<h2><span class="header-section-number">4.2</span> Manipulating date variables<a href="data-wrangling-beyond-basics.html#manipulating-date-variables" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Remember the weather data we loaded in at the start. We have weather data from the Palmer Station in Antarctica from 1989 - 2019. These data are available for each day</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="data-wrangling-beyond-basics.html#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(weather)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    10674 obs. of  24 variables:
##  $ Date                           : chr  &quot;1989-04-01&quot; &quot;1989-04-02&quot; &quot;1989-04-03&quot; &quot;1989-04-04&quot; ...
##  $ Temperature.High..C.           : num  2.8 1.1 -0.6 1.1 -0.6 2.5 -1.4 -0.8 -1 -1.5 ...
##  $ Temperature.Low..C.            : num  -1 -2.7 -3.5 -4.4 -2.9 -3.1 -3.2 -4.5 -4 -3.8 ...
##  $ Temperature.Average..C.        : num  0.9 -0.8 -2.05 -1.65 -1.75 -0.3 -2.3 -2.65 -2.5 -2.65 ...
##  $ Sea.Surface.Temperature..C.    : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ Sea.Ice..WMO.Code.             : chr  &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; ...
##  $ Pressure.High..mbar.           : num  1004 998 998 1002 1002 ...
##  $ Pressure.Low..mbar.            : num  998 995 995 998 997 ...
##  $ Pressure.Average..mbar.        : num  1001 996 997 1000 1000 ...
##  $ Windspeed.Peak                 : int  18 24 13 14 14 15 16 39 27 16 ...
##  $ Windspeed.5.Sec.Peak           : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ Windspeed.2.Min.Peak           : int  NA NA NA NA NA NA NA NA NA NA ...
##  $ Windspeed.Average              : num  4 9 8 6 4 4 8 14 11 6 ...
##  $ Wind.Peak.Direction..True...º. : int  110 30 60 210 230 180 40 120 50 60 ...
##  $ Wind.Peak.Direction..º.        : int  NA NA NA NA NA NA NA NA NA NA ...
##  $ Wind.5.Sec.Peak.Direction...º. : int  NA NA NA NA NA NA NA NA NA NA ...
##  $ Wind.2.Min.Peak.Direction...º. : int  NA NA NA NA NA NA NA NA NA NA ...
##  $ Wind.Direction.Prevailing      : chr  &quot;SW&quot; &quot;NE&quot; &quot;NE&quot; &quot;NW&quot; ...
##  $ Rainfall..mm.                  : num  0 0 0 0 0 0 1 0 0 -998 ...
##  $ Precipitation.Snow..cm.        : num  0 0 0 0 0 0 -998 0 0 -998 ...
##  $ Depth.at.Snowstake..cm.        : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ Cloud.Cover                    : int  4 2 5 5 10 2 9 5 0 10 ...
##  $ Data.flag...Temperature.Average: chr  &quot;C&quot; &quot;C&quot; &quot;C&quot; &quot;C&quot; ...
##  $ Data.flag...Pressure.Average   : chr  &quot;C&quot; &quot;C&quot; &quot;C&quot; &quot;C&quot; ...</code></pre>
<p>However, the structure of the data above indicate that the first variable, Date, is a ‘character’. This means that R is not reading these dates as numbers, and so we cannot manipulate them any further (e.g. extracting certain years).</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="data-wrangling-beyond-basics.html#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(weather<span class="sc">$</span>Date)</span></code></pre></div>
<pre><code>## [1] &quot;1989-04-01&quot; &quot;1989-04-02&quot; &quot;1989-04-03&quot; &quot;1989-04-04&quot; &quot;1989-04-05&quot;
## [6] &quot;1989-04-06&quot;</code></pre>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="data-wrangling-beyond-basics.html#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(weather<span class="sc">$</span>Date)</span></code></pre></div>
<pre><code>## [1] &quot;character&quot;</code></pre>
<p>We want to use the <code>lubridate</code> package (loaded in when we load in <code>tidyverse</code>) to convert these variables into dates and create a column for the year. This package is handy because it has very intuitive function names and argument structures. For instance, you can convert a character data type into a date type by using a function with letters representing the date format. You can see all of these formats by specifically calling upon the lubridate package and then using semicolons to call upon the functions, such as those starting with ‘y’. In lubridate, y = year, m = month, d = day, h = hour, m = minute, s = second, etc.</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="data-wrangling-beyond-basics.html#cb70-1" aria-hidden="true" tabindex="-1"></a>lubridate<span class="sc">::</span>y</span></code></pre></div>
<p>We can see that our data is formatted in the year-month-day format, and so we can use the <code>ymd</code> function to indicate to R what format we want it to detect as it converts characters to dates. If we use this function and assign the output to a date vector, we can then evaluate the class to see that it is a date.</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="data-wrangling-beyond-basics.html#cb71-1" aria-hidden="true" tabindex="-1"></a>date_vector <span class="ot">&lt;-</span> <span class="fu">ymd</span>(weather<span class="sc">$</span>Date)</span>
<span id="cb71-2"><a href="data-wrangling-beyond-basics.html#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(date_vector)</span></code></pre></div>
<pre><code>## [1] &quot;Date&quot;</code></pre>
<p>Important to remember that manipulating a column does not mean it automatically saves into the data frame. Instead, we need to remember to write (or overwrite) that column into our data frame. Remember that we can use the mutate function to do this, where we can overwrite out date column. Note two different ways of doing this. First, we could use the <code>ymd</code> function directly in our mutate function:</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="data-wrangling-beyond-basics.html#cb73-1" aria-hidden="true" tabindex="-1"></a>weather <span class="ot">&lt;-</span> <span class="fu">mutate</span>(weather, <span class="at">Date =</span> <span class="fu">ymd</span>(Date))</span></code></pre></div>
<p>Or because we have saved the new date data as its own vector, we can feed that vector into the data frame as is.</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="data-wrangling-beyond-basics.html#cb74-1" aria-hidden="true" tabindex="-1"></a>weather <span class="ot">&lt;-</span> <span class="fu">mutate</span>(weather, <span class="at">Date =</span> date_vector)</span></code></pre></div>
<p>Now we have our date data saved in our data frame.</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="data-wrangling-beyond-basics.html#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(weather<span class="sc">$</span>Date)</span></code></pre></div>
<pre><code>## [1] &quot;Date&quot;</code></pre>
<p>Now that R recognizes these as dates, we can extract certain date-related features, such as the year, month, and day. The lubridate package has functions conveniently named <code>year()</code>, <code>month()</code>, <code>day()</code> that can be used with a date argument, and that element of the date will be extracted. For example:</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="data-wrangling-beyond-basics.html#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">year</span>(weather<span class="sc">$</span>Date), <span class="at">n =</span> <span class="dv">75</span>)</span></code></pre></div>
<pre><code>##  [1] 1989 1989 1989 1989 1989 1989 1989 1989 1989 1989 1989 1989 1989 1989 1989
## [16] 1989 1989 1989 1989 1989 1989 1989 1989 1989 1989 1989 1989 1989 1989 1989
## [31] 1989 1989 1989 1989 1989 1989 1989 1989 1989 1989 1989 1989 1989 1989 1989
## [46] 1989 1989 1989 1989 1989 1989 1989 1989 1989 1989 1989 1989 1989 1989 1989
## [61] 1989 1989 1989 1989 1989 1989 1989 1989 1989 1989 1989 1989 1989 1989 1989</code></pre>
<p>Again, let’s use mutate to assign this as a new column</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="data-wrangling-beyond-basics.html#cb79-1" aria-hidden="true" tabindex="-1"></a>weather <span class="ot">&lt;-</span> <span class="fu">mutate</span>(weather, <span class="at">year =</span> <span class="fu">year</span>(Date))</span></code></pre></div>
<div id="check-in-challenge-2" class="section level3 hasAnchor" number="4.2.1">
<h3><span class="header-section-number">4.2.1</span> Check in challenge<a href="data-wrangling-beyond-basics.html#check-in-challenge-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We are going to review our basic wrangling skills to prepare the Palmer Station weather data to merge with the penguins data.</p>
<p>We would like to merge a <em>summary</em> of the weather data with the penguins. For this summary, we want the data summarized by year, rather than by day (as it currently is). Then per year, we want to know the maximum, minimum, and average temperatures. Create this summary table called ‘weather_summary’.</p>
<details>
<summary>
Check your answer
</summary>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="data-wrangling-beyond-basics.html#cb80-1" aria-hidden="true" tabindex="-1"></a>weather_summary <span class="ot">&lt;-</span> weather <span class="sc">%&gt;%</span> </span>
<span id="cb80-2"><a href="data-wrangling-beyond-basics.html#cb80-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span> </span>
<span id="cb80-3"><a href="data-wrangling-beyond-basics.html#cb80-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">average_temp =</span> <span class="fu">mean</span>(Temperature.Average..C., <span class="at">na.rm =</span> T),</span>
<span id="cb80-4"><a href="data-wrangling-beyond-basics.html#cb80-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">max_temp =</span> <span class="fu">max</span>(Temperature.High..C., <span class="at">na.rm =</span> T),</span>
<span id="cb80-5"><a href="data-wrangling-beyond-basics.html#cb80-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">min_temp =</span> <span class="fu">min</span>(Temperature.Low..C., <span class="at">na.rm =</span> T))</span></code></pre></div>
</details>
</div>
</div>
<div id="joining-multiple-data-frames" class="section level2 hasAnchor" number="4.3">
<h2><span class="header-section-number">4.3</span> Joining multiple data frames<a href="data-wrangling-beyond-basics.html#joining-multiple-data-frames" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In your data wrangling journey, you will often find yourself wanting to combine one data frame with some kind of supplementary or partner data frame. In our case, we have the penguins and weather data stored separately, but if we ever wanted to explore any relationships between them, we’d likely want all of that data stored in one place so that we can line up data points. This lining up of data points is called <strong>joining</strong> in the tidyverse language.</p>
<p>The key to joining is to identify the variables by which you want to join the data. In other words, which columns in each data are the ones that link them together. In some cases these may be one-to-one matches (e.g. identification numbers to identification numbers), or in other cases there is data at different levels that need to be lined up. By default, join functions will link the data together based on all of the shared column names, but usually you’ll want to double check to make sure that this will get you what you want. Typically you can do this by just checking out the column names of each data frame (for this exercise we will sue the weather_summary object created in the last challenge).</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="data-wrangling-beyond-basics.html#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(penguins)</span></code></pre></div>
<pre><code>## [1] &quot;species&quot;           &quot;island&quot;            &quot;bill_length_mm&quot;   
## [4] &quot;bill_depth_mm&quot;     &quot;flipper_length_mm&quot; &quot;body_mass_g&quot;      
## [7] &quot;sex&quot;               &quot;year&quot;</code></pre>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="data-wrangling-beyond-basics.html#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(weather_summary)</span></code></pre></div>
<pre><code>## [1] &quot;year&quot;         &quot;average_temp&quot; &quot;max_temp&quot;     &quot;min_temp&quot;</code></pre>
<p>We have one column overlapping, year, which makes it the likely candidate for joining by. But it is also important to think: what is it that actually links penguins to weather? Penguins experience weather at any given time, and so we will need to choose a shared time scale at which penguins are experiencing weather and the scale of data we collected for weather. In the penguins data set we only know the year that the observations were taken, so we’re interested in the annual weather summaries. This is why we are looking at the weather summary object, so that we can align the data relatively well.</p>
<p>Now, let’s join. The join functons take three arguments: the two data frames you’d like to join, and the name of the column by which to join. There are also several types of joins, which we can explore in the challenge, but for now let’s use a left join:</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="data-wrangling-beyond-basics.html#cb85-1" aria-hidden="true" tabindex="-1"></a>penguins_leftjoined <span class="ot">&lt;-</span> <span class="fu">left_join</span>(penguins, weather_summary, <span class="at">by =</span> <span class="st">&quot;year&quot;</span>)</span></code></pre></div>
<p>Now, we go from 8 columns in the penguins data to 11, now that we’ve appended the three weather-related columns to the data. And we stick with 344 rows because that is the number of rows in our ‘left’ data frame, penguins. These dimensions might change depending on the kind of join you use.</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="data-wrangling-beyond-basics.html#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(penguins_leftjoined)</span></code></pre></div>
<pre><code>## [1] 344  11</code></pre>
<div id="check-in-challenge-3" class="section level3 hasAnchor" number="4.3.1">
<h3><span class="header-section-number">4.3.1</span> Check in challenge<a href="data-wrangling-beyond-basics.html#check-in-challenge-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Go ahead and check out the documentation for join by using the help function, a question mark:</p>
<pre><code>?join</code></pre>
<p>You’ll see the variety of joins that exist in dplyr. Try to experiment with them: What happens when you use another kind of join? Check how the dimensions of the data change depending on the join you choose.</p>
<details>
<summary>
Check your answer
</summary>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="data-wrangling-beyond-basics.html#cb89-1" aria-hidden="true" tabindex="-1"></a>penguins_fulljoined <span class="ot">&lt;-</span> <span class="fu">full_join</span>(penguins, weather_summary, <span class="at">by =</span> <span class="st">&quot;year&quot;</span>)</span>
<span id="cb89-2"><a href="data-wrangling-beyond-basics.html#cb89-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(penguins_fulljoined)</span></code></pre></div>
<pre><code>## [1] 372  11</code></pre>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="data-wrangling-beyond-basics.html#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We now have more rows. Why? We had weather data for more years than we have penguin data, so we have a lot of weather data that is unmatched to any pengion observation</span></span></code></pre></div>
</details>
</div>
</div>
<div id="reshaping-lengtheningwidening-data" class="section level2 hasAnchor" number="4.4">
<h2><span class="header-section-number">4.4</span> Reshaping (lengthening/widening) data<a href="data-wrangling-beyond-basics.html#reshaping-lengtheningwidening-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>There are often cases where you’d like to change the shape of your data. For instance, you might want to turn several columns into two: one with the measurements or values from the previous columns, and one with a categorical indicator of what is represented in the new column. This is a case for pivoting longer.</p>
<p>Let’s say we wanted to take the key measures of our penguins and stack them on top of one another (this is not actually useful given our data, but it is the practice that counts). When we stack all of these columns on top of one another we are going to be creating two new columns: one with the names of the columns and another with the values of the columns. In the pivot_ arguments, it looks like this:</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="data-wrangling-beyond-basics.html#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Pivot the data to make it longer</span></span>
<span id="cb92-2"><a href="data-wrangling-beyond-basics.html#cb92-2" aria-hidden="true" tabindex="-1"></a>penguins_longer <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(penguins, </span>
<span id="cb92-3"><a href="data-wrangling-beyond-basics.html#cb92-3" aria-hidden="true" tabindex="-1"></a>                                <span class="at">cols =</span> <span class="fu">c</span>(bill_length_mm, bill_depth_mm,</span>
<span id="cb92-4"><a href="data-wrangling-beyond-basics.html#cb92-4" aria-hidden="true" tabindex="-1"></a>                                         flipper_length_mm, body_mass_g), </span>
<span id="cb92-5"><a href="data-wrangling-beyond-basics.html#cb92-5" aria-hidden="true" tabindex="-1"></a>                                <span class="at">names_to =</span> <span class="st">&quot;measure&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="data-wrangling-beyond-basics.html#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(penguins_longer)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 6
##   species island    sex     year measure            value
##   &lt;fct&gt;   &lt;fct&gt;     &lt;fct&gt;  &lt;int&gt; &lt;chr&gt;              &lt;dbl&gt;
## 1 Adelie  Torgersen male    2007 bill_length_mm      39.1
## 2 Adelie  Torgersen male    2007 bill_depth_mm       18.7
## 3 Adelie  Torgersen male    2007 flipper_length_mm  181  
## 4 Adelie  Torgersen male    2007 body_mass_g       3750  
## 5 Adelie  Torgersen female  2007 bill_length_mm      39.5
## 6 Adelie  Torgersen female  2007 bill_depth_mm       17.4</code></pre>
<p>The reverse scenario is having data within one column that you’d like to widen out into several columns. Here we have to identify the column we’d like to unstack (values_from), how we’d like to name the new columns filled with the widened values (names_from). Note thay we don’t need to put these column names in quotes because they already exist in the data frame!</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="data-wrangling-beyond-basics.html#cb95-1" aria-hidden="true" tabindex="-1"></a>penguins_wider <span class="ot">&lt;-</span> <span class="fu">pivot_wider</span>(penguins_longer, </span>
<span id="cb95-2"><a href="data-wrangling-beyond-basics.html#cb95-2" aria-hidden="true" tabindex="-1"></a>                              <span class="at">names_from =</span> measure, </span>
<span id="cb95-3"><a href="data-wrangling-beyond-basics.html#cb95-3" aria-hidden="true" tabindex="-1"></a>                              <span class="at">values_from =</span> value)</span></code></pre></div>
<pre><code>## Warning: Values from `value` are not uniquely identified; output will contain list-cols.
## • Use `values_fn = list` to suppress this warning.
## • Use `values_fn = {summary_fun}` to summarise duplicates.
## • Use the following dplyr code to identify duplicates.
##   {data} %&gt;%
##   dplyr::group_by(species, island, sex, year, measure) %&gt;%
##   dplyr::summarise(n = dplyr::n(), .groups = &quot;drop&quot;) %&gt;%
##   dplyr::filter(n &gt; 1L)</code></pre>
<p>BUT, we get a bit of an issue here. Our result has condensed many of the measures down into list forms, leaving us with only 35 observations and several repeated measured for each observation. Why? When dplyr is widening out the data it wants to match the new columns to <em>unique observations</em>. So the function created one row for each species-island-sex-year combination, thinking those are unique. We can fix this by setting id_cols.</p>
<p>Here want to specify what it is that actually identifies unique observations in the data. Our issue is that we don’t have unique identifiers in the data. Woops. Let’s fix that and re-run these functions to see why this matters.</p>
<p>First, let’s assign a unique ID column to the penguins_wider data:</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="data-wrangling-beyond-basics.html#cb97-1" aria-hidden="true" tabindex="-1"></a>penguins<span class="sc">$</span>ID <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(penguins)</span>
<span id="cb97-2"><a href="data-wrangling-beyond-basics.html#cb97-2" aria-hidden="true" tabindex="-1"></a>penguins_longer <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(penguins, </span>
<span id="cb97-3"><a href="data-wrangling-beyond-basics.html#cb97-3" aria-hidden="true" tabindex="-1"></a>                                <span class="at">cols =</span> <span class="fu">c</span>(bill_length_mm, bill_depth_mm,</span>
<span id="cb97-4"><a href="data-wrangling-beyond-basics.html#cb97-4" aria-hidden="true" tabindex="-1"></a>                                         flipper_length_mm, body_mass_g), </span>
<span id="cb97-5"><a href="data-wrangling-beyond-basics.html#cb97-5" aria-hidden="true" tabindex="-1"></a>                                <span class="at">names_to =</span> <span class="st">&quot;measure&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="data-wrangling-beyond-basics.html#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(penguins_longer)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 7
##   species island    sex     year    ID measure            value
##   &lt;fct&gt;   &lt;fct&gt;     &lt;fct&gt;  &lt;int&gt; &lt;int&gt; &lt;chr&gt;              &lt;dbl&gt;
## 1 Adelie  Torgersen male    2007     1 bill_length_mm      39.1
## 2 Adelie  Torgersen male    2007     1 bill_depth_mm       18.7
## 3 Adelie  Torgersen male    2007     1 flipper_length_mm  181  
## 4 Adelie  Torgersen male    2007     1 body_mass_g       3750  
## 5 Adelie  Torgersen female  2007     2 bill_length_mm      39.5
## 6 Adelie  Torgersen female  2007     2 bill_depth_mm       17.4</code></pre>
<p>Now, let’s set ID as the the id_cols argument in the function:</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="data-wrangling-beyond-basics.html#cb100-1" aria-hidden="true" tabindex="-1"></a>penguins_widerID <span class="ot">&lt;-</span> <span class="fu">pivot_wider</span>(penguins_longer, </span>
<span id="cb100-2"><a href="data-wrangling-beyond-basics.html#cb100-2" aria-hidden="true" tabindex="-1"></a>                                <span class="at">id_cols =</span> ID,</span>
<span id="cb100-3"><a href="data-wrangling-beyond-basics.html#cb100-3" aria-hidden="true" tabindex="-1"></a>                                <span class="at">names_from =</span> measure, </span>
<span id="cb100-4"><a href="data-wrangling-beyond-basics.html#cb100-4" aria-hidden="true" tabindex="-1"></a>                                <span class="at">values_from =</span> value)</span>
<span id="cb100-5"><a href="data-wrangling-beyond-basics.html#cb100-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(penguins_widerID)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 5
##      ID bill_length_mm bill_depth_mm flipper_length_mm body_mass_g
##   &lt;int&gt;          &lt;dbl&gt;         &lt;dbl&gt;             &lt;dbl&gt;       &lt;dbl&gt;
## 1     1           39.1          18.7               181        3750
## 2     2           39.5          17.4               186        3800
## 3     3           40.3          18                 195        3250
## 4     4           NA            NA                  NA          NA
## 5     5           36.7          19.3               193        3450
## 6     6           39.3          20.6               190        3650</code></pre>
<p>Uh, close, but still some issues. What happened to all of our other columns? Well, since we said ID was our only id column, it dropped everything else. So we can actually pile everything into our ID column that we wan to keep</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="data-wrangling-beyond-basics.html#cb102-1" aria-hidden="true" tabindex="-1"></a>penguins_widerID_allcols <span class="ot">&lt;-</span> <span class="fu">pivot_wider</span>(penguins_longer, </span>
<span id="cb102-2"><a href="data-wrangling-beyond-basics.html#cb102-2" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">id_cols =</span> species<span class="sc">:</span>ID,</span>
<span id="cb102-3"><a href="data-wrangling-beyond-basics.html#cb102-3" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">names_from =</span> <span class="st">&quot;measure&quot;</span>, </span>
<span id="cb102-4"><a href="data-wrangling-beyond-basics.html#cb102-4" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">values_from =</span> <span class="st">&quot;value&quot;</span>)</span>
<span id="cb102-5"><a href="data-wrangling-beyond-basics.html#cb102-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(penguins_widerID_allcols)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 9
##   species island    sex     year    ID bill_length_mm bill_depth_mm
##   &lt;fct&gt;   &lt;fct&gt;     &lt;fct&gt;  &lt;int&gt; &lt;int&gt;          &lt;dbl&gt;         &lt;dbl&gt;
## 1 Adelie  Torgersen male    2007     1           39.1          18.7
## 2 Adelie  Torgersen female  2007     2           39.5          17.4
## 3 Adelie  Torgersen female  2007     3           40.3          18  
## 4 Adelie  Torgersen &lt;NA&gt;    2007     4           NA            NA  
## 5 Adelie  Torgersen female  2007     5           36.7          19.3
## 6 Adelie  Torgersen male    2007     6           39.3          20.6
## # ℹ 2 more variables: flipper_length_mm &lt;dbl&gt;, body_mass_g &lt;dbl&gt;</code></pre>
</div>
<div id="working-with-text" class="section level2 hasAnchor" number="4.5">
<h2><span class="header-section-number">4.5</span> Working with text<a href="data-wrangling-beyond-basics.html#working-with-text" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Let’s back up a bit to the cleaning process. We’ve been working on getting our data in summary form, bringing in new data, and changing data shape, all of which is pretty far down the data wrangling pipeline. But we are going to take this last moment to talk about an earlier stage task: cleaning text data.</p>
<p>When we first create and collect data, it may not be in its tidy-est form. One common un-tidy data practice is to have multiple types of data in one column. For instance, we can look at the ‘raw’ version of the penguins data, also available through the package. Go ahead and read that in:</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="data-wrangling-beyond-basics.html#cb104-1" aria-hidden="true" tabindex="-1"></a>penguins_raw <span class="ot">&lt;-</span> penguins_raw</span></code></pre></div>
<p>Let’s look at the third and sixth columns, for instance.</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="data-wrangling-beyond-basics.html#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">select</span>(penguins_raw, <span class="dv">3</span>,<span class="dv">6</span>))</span></code></pre></div>
<pre><code>## # A tibble: 6 × 2
##   Species                             Stage             
##   &lt;chr&gt;                               &lt;chr&gt;             
## 1 Adelie Penguin (Pygoscelis adeliae) Adult, 1 Egg Stage
## 2 Adelie Penguin (Pygoscelis adeliae) Adult, 1 Egg Stage
## 3 Adelie Penguin (Pygoscelis adeliae) Adult, 1 Egg Stage
## 4 Adelie Penguin (Pygoscelis adeliae) Adult, 1 Egg Stage
## 5 Adelie Penguin (Pygoscelis adeliae) Adult, 1 Egg Stage
## 6 Adelie Penguin (Pygoscelis adeliae) Adult, 1 Egg Stage</code></pre>
<p>The Stage column is a good example of where multiple data points might be combined into one cell as text. Here we have ‘Adult, 1 Egg Stage’ reported. But, we might want to separate out the title of the penguin’s stage, Adult, from their egg stage count. For this we can use the <code>separate</code> function to divide the contents of one column into multiple based on particular symbols. In this case, there is a convention to separate the word Adult (or other stage) from the egg count using a comma (,).</p>
<p>For the <code>separate</code> function we need to enter a few arguments: the data, the column to separate, the names of the new columns, and the separator symbol. Note that the help file says that the separator symbol is “interpreted as a regular expression” – we’ll get to to that in a second.</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="data-wrangling-beyond-basics.html#cb107-1" aria-hidden="true" tabindex="-1"></a>penguins_raw_sep <span class="ot">&lt;-</span> <span class="fu">separate</span>(penguins_raw, Stage, <span class="fu">c</span>(<span class="st">&quot;age_cat&quot;</span>, <span class="st">&quot;egg_stage&quot;</span>), <span class="st">&#39;,&#39;</span>)</span></code></pre></div>
<p>Now we can see that these two have replace the previous Stage column, and has added one more column to the data frame.</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="data-wrangling-beyond-basics.html#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">select</span>(penguins_raw_sep, <span class="dv">4</span><span class="sc">:</span><span class="dv">7</span>))</span></code></pre></div>
<pre><code>## # A tibble: 6 × 4
##   Region Island    age_cat egg_stage     
##   &lt;chr&gt;  &lt;chr&gt;     &lt;chr&gt;   &lt;chr&gt;         
## 1 Anvers Torgersen Adult   &quot; 1 Egg Stage&quot;
## 2 Anvers Torgersen Adult   &quot; 1 Egg Stage&quot;
## 3 Anvers Torgersen Adult   &quot; 1 Egg Stage&quot;
## 4 Anvers Torgersen Adult   &quot; 1 Egg Stage&quot;
## 5 Anvers Torgersen Adult   &quot; 1 Egg Stage&quot;
## 6 Anvers Torgersen Adult   &quot; 1 Egg Stage&quot;</code></pre>
<p>Now, we could even go one step further. The data here are well organized and uniform, meaning that separate works quite well. Every Stage column has a comma, and even now in the egg_stage column, there are three words, so we could separate by a space ” ” and get three new columns. However, when data is messy we might need some more powerful text manipulation tools.</p>
<p>Enter: the <code>stringr</code> package and regular expressions. Stringr is a package providing a set of functions for manipulating “strings”, also called text or character data. Check out the great <a href="https://github.com/rstudio/cheatsheets/blob/main/strings.pdf">stringr cheat sheet</a>. Part of what makes stringr to powerful is that it relies on patterns interpreted as ‘regular expressions’ (or regex). Regex is its own pattern language that allows you to generalize string patterns for great adaptability to string cleaning.</p>
<p>We will practice just one example, which is to extract the number from the egg_stage column. The power of regex is that instead of specifying every possible number that could exist in the column, there is a symbol for numbers in the regex language, which is <code>\\d</code>. There is also a symbol to quantify the number of symbols, where <code>?</code> is zero or one, <code>*</code> is zero or more, <code>+</code> is one or more, etc. By combining <code>\\d+</code> we’ve created a regular expression for the pattern: one or more digits. We can then use this in one of the string functions, <code>str_extract</code>, with the two arguments it needs: the character vector and the pattern.</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="data-wrangling-beyond-basics.html#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_extract</span>(penguins_raw_sep<span class="sc">$</span>egg_stage, <span class="st">&#39;</span><span class="sc">\\</span><span class="st">d+&#39;</span>)</span></code></pre></div>
<pre><code>##   [1] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot;
##  [19] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot;
##  [37] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot;
##  [55] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot;
##  [73] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot;
##  [91] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot;
## [109] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot;
## [127] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot;
## [145] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot;
## [163] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot;
## [181] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot;
## [199] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot;
## [217] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot;
## [235] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot;
## [253] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot;
## [271] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot;
## [289] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot;
## [307] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot;
## [325] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot;
## [343] &quot;1&quot; &quot;1&quot;</code></pre>
<p>Excellent. Our pattern worked and we’ve successfully extracted the number pattern from the column. One tiny tweak is that the numbers are in quotation marks, meaning that they are still character data. We can coerce them to numeric once they are all numbers.</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="data-wrangling-beyond-basics.html#cb112-1" aria-hidden="true" tabindex="-1"></a>penguins_raw_sep<span class="sc">$</span>egg_no <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">str_extract</span>(penguins_raw_sep<span class="sc">$</span>egg_stage,</span>
<span id="cb112-2"><a href="data-wrangling-beyond-basics.html#cb112-2" aria-hidden="true" tabindex="-1"></a>                                                  <span class="st">&#39;</span><span class="sc">\\</span><span class="st">d+&#39;</span>))</span>
<span id="cb112-3"><a href="data-wrangling-beyond-basics.html#cb112-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(penguins_raw_sep<span class="sc">$</span>egg_no)</span></code></pre></div>
<pre><code>## [1] 1 1 1 1 1 1</code></pre>
<p>Finally, want to put things back together? The <code>paste</code> function is a straightforward way to paste columns or values back together. The arguments for paste are as many value you’d like to paste together, separated by a comma. For instance:</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="data-wrangling-beyond-basics.html#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">paste</span>(penguins_raw_sep<span class="sc">$</span>age_cat, penguins_raw_sep<span class="sc">$</span>egg_stage))</span></code></pre></div>
<pre><code>## [1] &quot;Adult  1 Egg Stage&quot; &quot;Adult  1 Egg Stage&quot; &quot;Adult  1 Egg Stage&quot;
## [4] &quot;Adult  1 Egg Stage&quot; &quot;Adult  1 Egg Stage&quot; &quot;Adult  1 Egg Stage&quot;</code></pre>
<p>And you can also mix and match data types and lengths, etc:</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="data-wrangling-beyond-basics.html#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(<span class="st">&quot;Paste together items of different lengths, for example:&quot;</span>, </span>
<span id="cb116-2"><a href="data-wrangling-beyond-basics.html#cb116-2" aria-hidden="true" tabindex="-1"></a>      <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="st">&quot;different items&quot;</span>)</span></code></pre></div>
<pre><code>##  [1] &quot;Paste together items of different lengths, for example: 1 different items&quot; 
##  [2] &quot;Paste together items of different lengths, for example: 2 different items&quot; 
##  [3] &quot;Paste together items of different lengths, for example: 3 different items&quot; 
##  [4] &quot;Paste together items of different lengths, for example: 4 different items&quot; 
##  [5] &quot;Paste together items of different lengths, for example: 5 different items&quot; 
##  [6] &quot;Paste together items of different lengths, for example: 6 different items&quot; 
##  [7] &quot;Paste together items of different lengths, for example: 7 different items&quot; 
##  [8] &quot;Paste together items of different lengths, for example: 8 different items&quot; 
##  [9] &quot;Paste together items of different lengths, for example: 9 different items&quot; 
## [10] &quot;Paste together items of different lengths, for example: 10 different items&quot;</code></pre>
<div id="check-in-challenge-4" class="section level3 hasAnchor" number="4.5.1">
<h3><span class="header-section-number">4.5.1</span> Check in challenge<a href="data-wrangling-beyond-basics.html#check-in-challenge-4" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Try to separate the common name from the scientific name from the ‘Species’ column in penguins_raw. E.g. separate ‘Adelie Penguin (Pygoscelis adeliae)’ into two columns: ‘Adelie Penguin’ and ‘Pygoscelis adeliae’. You may need to combine separate with a stringr function (e.g. <code>str_remove</code>) depending on how you’d like to deal with the parentheses. Note that parentheses in regular expressions are special characters and will need to be treated as such both in the <code>separate</code> and <code>stringr</code> functions – see the cheat sheet!</p>
<details>
<summary>
Check your answer
</summary>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="data-wrangling-beyond-basics.html#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Separate by the first opening parentheses</span></span>
<span id="cb118-2"><a href="data-wrangling-beyond-basics.html#cb118-2" aria-hidden="true" tabindex="-1"></a>penguins_raw <span class="ot">&lt;-</span> <span class="fu">separate</span>(penguins_raw, Species, </span>
<span id="cb118-3"><a href="data-wrangling-beyond-basics.html#cb118-3" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">c</span>(<span class="st">&quot;common_name&quot;</span>, <span class="st">&quot;sci_name&quot;</span>), <span class="st">&quot;</span><span class="sc">\\</span><span class="st">(&quot;</span>)</span>
<span id="cb118-4"><a href="data-wrangling-beyond-basics.html#cb118-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Then remove the second closing parentheses with stringr</span></span>
<span id="cb118-5"><a href="data-wrangling-beyond-basics.html#cb118-5" aria-hidden="true" tabindex="-1"></a>penguins_raw<span class="sc">$</span>sci_name <span class="ot">&lt;-</span> <span class="fu">str_remove</span>(penguins_raw<span class="sc">$</span>sci_name, <span class="st">&quot;</span><span class="sc">\\</span><span class="st">)&quot;</span>)</span>
<span id="cb118-6"><a href="data-wrangling-beyond-basics.html#cb118-6" aria-hidden="true" tabindex="-1"></a><span class="co"># I also like to use the base R function &#39;trimws&#39; to trim white space</span></span>
<span id="cb118-7"><a href="data-wrangling-beyond-basics.html#cb118-7" aria-hidden="true" tabindex="-1"></a>penguins_raw<span class="sc">$</span>common_name <span class="ot">&lt;-</span> <span class="fu">trimws</span>(penguins_raw<span class="sc">$</span>common_name)</span>
<span id="cb118-8"><a href="data-wrangling-beyond-basics.html#cb118-8" aria-hidden="true" tabindex="-1"></a>penguins_raw<span class="sc">$</span>sci_name <span class="ot">&lt;-</span> <span class="fu">trimws</span>(penguins_raw<span class="sc">$</span>sci_name)</span>
<span id="cb118-9"><a href="data-wrangling-beyond-basics.html#cb118-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Let&#39;s take a look</span></span>
<span id="cb118-10"><a href="data-wrangling-beyond-basics.html#cb118-10" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">select</span>(penguins_raw, common_name, sci_name))</span></code></pre></div>
<pre><code>## # A tibble: 6 × 2
##   common_name    sci_name          
##   &lt;chr&gt;          &lt;chr&gt;             
## 1 Adelie Penguin Pygoscelis adeliae
## 2 Adelie Penguin Pygoscelis adeliae
## 3 Adelie Penguin Pygoscelis adeliae
## 4 Adelie Penguin Pygoscelis adeliae
## 5 Adelie Penguin Pygoscelis adeliae
## 6 Adelie Penguin Pygoscelis adeliae</code></pre>
</details>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="data-wrangling-basics.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="visualization.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
},
"code_folding": "show"
});
});
</script>

</body>

</html>
