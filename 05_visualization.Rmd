# Visualization

## Outline
* Plot architecture
  * `ggplot`
  * `aes`
  * `geom_`
* Selecting geometries
  * `geom_point`
  * `geom_bar` and `geom_col`
  * `geom_boxplot`
  * `geom_line`
* Styling (automatic and manual)
  * `labs` 
  * `theme_`
  * `scale_`
* Facets

```{r, echo = F, warning = F, message = F}
library(tidyverse)
library(palmerpenguins)
library(lubridate)
weather <- read.csv("https://pasta.lternet.edu/package/data/eml/knb-lter-pal/28/8/375b34051b162d84516ec2d02f864675") 
weather <- weather %>% 
  mutate(Date = ymd(Date),
         year = year(Date))
```

## Plot architecture

Create a scatterplot of...

```{r}
ggplot(data = penguins,
                         aes(x = bill_length_mm,
                             y = bill_depth_mm)) +
  geom_point()
```
```{r}
ggplot(data = penguins,
                         aes(x = bill_length_mm,
                             y = bill_depth_mm)) +
  geom_point(alpha = .8, size = 3)
```

What;s the trend?
```{r}
ggplot(data = penguins,
                         aes(x = bill_length_mm,
                             y = bill_depth_mm)) +
  geom_point(alpha = .8, size = 3) +
  geom_smooth(method = "lm", se = FALSE)
```

BUT, exploratory data analysis is super important:
```{r}
ggplot(data = penguins,
               aes(x = bill_length_mm,
                   y = bill_depth_mm,
                   color = species)) +
  geom_point(alpha = .8, size = 3) +
  geom_smooth(method = "lm", se = FALSE)
```

Simpson's paradox!

## Selecting geometries

Create a barplot of species counts
```{r}
ggplot(penguins, aes(x = species)) + geom_bar()
```

```{r}
ggplot(penguins, aes(x = species, y = flipper_length_mm)) + geom_boxplot()
```


```{r}
weather %>% 
  ggplot(aes(x = Date, y = Temperature.Average..C.)) +
  geom_line()
```


```{r}
weather %>% 
  ungroup() %>% 
  ggplot(aes(x = year, y = Temperature.Average..C., group = year)) +
  geom_boxplot() 
```

We notice something weird... maybe check our end years?

```{r}
weather %>% 
  filter(year == min(year)) %>% 
  select(Date) %>% 
  summary(Date)
```

```{r}
weather %>% 
  filter(year == max(year)) %>% 
  select(Date) %>% 
  summary(Date)
```

```{r}
weather %>% 
  ungroup() %>% 
  filter(year != min(year) & year != max(year)) %>% 
  ggplot(aes(x = year, y = Temperature.Average..C., group = year)) +
  geom_boxplot() 
```

## Challenge
Conditional statements

```{r}
weather <- weather %>% 
  mutate(penguin_data_year = case_when(
    year %in% 2007:2009 ~ T,
    T ~ F
  ) )
```

```{r}
weather %>% 
  filter(year != min(year) & year != max(year)) %>% 
  ggplot(aes(x = year, y = Temperature.Average..C., group = year,
             color = penguin_data_year)) +
  geom_boxplot() 
```


## Styling (automatic and manual)

```{r}
base_p <- weather %>% 
  filter(year != min(year) & year != max(year)) %>% 
  ggplot(aes(x = year, y = Temperature.Average..C., group = year,
             color = penguin_data_year)) +
  geom_boxplot() 
```

```{r}
base_p +
  scale_color_manual(values = c("darkorange","cyan4"))
```

```{r}
base_p +
  scale_color_manual(values = c("darkorange","cyan4")) +
  labs(x = "Year", y = "Average Temperature (C)", 
       title = "Daily average temperature range at Palmer Station (1985-2018)",
       color = "Penguin data")
```

```{r}
base_p +
  scale_color_manual(values = c("darkorange","cyan4")) +
  labs(x = "Year", y = "Average Temperature (C)", 
       title = "Daily average temperature range at Palmer Station (1985-2018)",
       color = "Penguin data")
  theme_minimal()
```

# Analyzing relationships  

https://www.tmwr.org/
Body mass and bill length

lm

Flipper length and species

lm
anova

Body mass and bill length over time

lm